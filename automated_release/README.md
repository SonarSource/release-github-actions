# Automated Release GitHub Action

This GitHub Action provides a comprehensive automated release workflow that handles the complete release process including Jira ticket management, GitHub releases, and integration updates.

## Overview

The Automated Release Action performs the following key operations:
1. Locks the master branch during release
2. Checks releasability status and gets build version
3. Creates and manages Jira release tickets
4. Publishes GitHub releases
5. Releases versions in Jira
6. Updates integration tickets for SQS and SQC
7. Updates analyzers in downstream systems

## Inputs

### Required Inputs

| Input | Description |
|-------|-------------|
| `jira_project_key` | The key of the Jira project where the release ticket will be created |
| `jira_project_name` | The display name of the Jira project where the release ticket will be created |
| `short_description` | A brief summary of what the release contains. This will be added directly to the release ticket |
| `slack_channel` | The Slack channel where notifications will be sent (e.g., `squad-security-cloud-notifs`) |
| `analyzer_artifact_identifier` | The identifier for the analyzer artifact, used to update to the next version (e.g., `php`, `python`) |

### Optional Inputs

| Input | Description | Default                                               |
|-------|-------------|-------------------------------------------------------|
| `public` | Whether to build and deploy with/to public repositories. Set to `true` for public repositories (OSS), `false` for private | Auto-detected based on repository visibility          |
| `sq_compatibility` | SonarQube compatibility. Default needs to be changed only in case of LTA fix release | `>=10.8`                                              |
| `next_version` | Specify the version for the next release (e.g., `4.2.0`). | Minor version will be automatically incremented       |
| `jira_release_name` | The name of the release version in Jira. | Use the *only* unreleased version in the project      |
| `release_notes` | GitHub release notes. | Release notes will be generated from the Jira Release |
| `sonarlint_changelog` | A summary of release notes relevant to the SonarQube IDE extensions | -                                                     |
| `sqs_fix_versions` | A comma-separated list of fix versions for the SQS integration ticket (e.g., `sqs-2025.4, sqcb-25.7`) | -                                                     |
| `integration_prs_reviewers` | A comma-separated list of GitHub usernames to request as reviewers on integration PRs (e.g., `gh-username,another-user`) | -                                                     |
| `update_sqs` | If true, the action will update the analyzer in SQS | `true`                                                |
| `update_sqc` | If true, the action will update the analyzer in SQC | `true`                                                |
| `rel_ticket_assignee` | The email of the person to assign the release ticket to after the technical release is done | -                                                     |
| `use_jira_sandbox` | Use the sandbox server instead of the production Jira. Set to true for testing purposes | `false`                                               |
| `is_draft_release` | If true, the release will be created as a draft. Useful for preparing releases without publishing them immediately | `false`                                               |

## Outputs

| Output | Description |
|--------|-------------|
| `release_name` | Name of the release as generated by the Jira release ticket creation step |
| `release_ticket_key` | Key of the created Jira release ticket (e.g., `REL-123`) |
| `release_url` | URL of the Jira release page |
| `release_ticket_url` | URL of the created Jira release ticket |
| `sqs_ticket_key` | Key of the created SQS integration ticket (e.g., `SQS-123`) |
| `sqc_ticket_key` | Key of the created SQC integration ticket (e.g., `SQC-456`) |
| `sqs_ticket_url` | URL of the created SQS integration ticket |
| `sqc_ticket_url` | URL of the created SQC integration ticket |

## Usage Example

```yaml
name: Release
on:
  workflow_dispatch:
    inputs:
      short_description:
        description: 'Brief summary of the release'
        required: true
      next_version:
        description: 'Next version (optional)'
        required: false

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Automated Release
        uses: SonarSource/release-github-actions/automated_release@main
        with:
          jira_project_key: 'MYPROJECT'
          jira_project_name: 'My Project'
          short_description: ${{ github.event.inputs.short_description }}
          slack_channel: 'my-team-notifications'
          analyzer_artifact_identifier: 'javascript'
          next_version: ${{ github.event.inputs.next_version }}
          sqs_fix_versions: 'sqs-2025.4'
          integration_prs_reviewers: 'reviewer1,reviewer2'
```

## Prerequisites

This action requires the following secrets to be configured:
- Vault access for GitHub tokens and Slack API tokens
- Proper permissions for Jira project management
- Access to SQS and SQC systems for analyzer updates

## Workflow Steps

1. **Branch Locking**: Locks the master branch to prevent concurrent changes
2. **Releasability Check**: Validates that the repository is ready for release
3. **Jira Ticket Creation**: Creates a release ticket in the specified Jira project
4. **Release Publication**: Publishes the GitHub release and binaries
5. **Jira Release**: Marks the version as released in Jira and creates the next version
6. **Integration Updates**: Updates SQS and SQC integration tickets
7. **Analyzer Updates**: Updates the analyzer in downstream systems
8. **Branch Unlocking**: Unlocks the master branch

## Error Handling

The action includes comprehensive error handling and will unlock the master branch even if intermediate steps fail. All Jira operations can be performed against a sandbox environment for testing by setting `use_jira_sandbox: true`.
